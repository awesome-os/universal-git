---
title: SHA-256 Object Format
sidebar_label: SHA-256
---

# SHA-256 Object Format

Universal-git supports both SHA-1 and SHA-256 object formats, allowing you to create repositories with enhanced security using SHA-256 hashing.

## Overview

SHA-256 is an alternative object format that uses SHA-256 hashing instead of SHA-1:
- **SHA-1**: 40-character hex OIDs (legacy, default)
- **SHA-256**: 64-character hex OIDs (modern, more secure)

## Creating SHA-256 Repositories

### Initialize with SHA-256

```typescript
import { init } from 'universal-git'

// Create a new repository with SHA-256
await init({
  fs,
  dir: '/path/to/repo',
  objectFormat: 'sha256'
})
```

### Verify Object Format

```typescript
import { detectObjectFormat } from 'universal-git/utils/detectObjectFormat'

// Check the object format of an existing repository
const format = await detectObjectFormat(fs, gitdir)
console.log(format) // 'sha1' or 'sha256'
```

## Using SHA-256

### Writing Objects

All object writing operations support SHA-256:

```typescript
import { writeBlob, writeCommit, writeTree, writeTag } from 'universal-git'

// Write objects (format is detected automatically from repository)
const oid = await writeBlob({
  fs,
  gitdir,
  blob: UniversalBuffer.from('Hello, world!')
})

console.log(oid) // 64-character hex string for SHA-256
```

### Reading Objects

Object reading automatically detects the format:

```typescript
import { readObject } from 'universal-git'

// Read objects (format is detected automatically)
const { object, type } = await readObject({
  fs,
  cache,
  gitdir,
  oid: 'abc123...' // Can be SHA-1 or SHA-256
})
```

### Hashing Objects

```typescript
import { hashBlob } from 'universal-git'

// Hash with SHA-256
const result = await hashBlob({
  object: 'Hello, world!',
  objectFormat: 'sha256'
})

console.log(result.oid) // 64-character hex string
```

## Supported Formats

SHA-256 is fully supported for:

- ✅ **Loose objects** - Individual object files
- ✅ **Packfiles** - Packed objects (`.pack` files)
- ✅ **Pack indices** - Pack index files (`.idx` files)
- ✅ **Multi-pack-index** - Multi-pack index files
- ✅ **Index** - Staging area index file
- ✅ **Tree objects** - Directory listings
- ✅ **Commit objects** - Commit metadata
- ✅ **Tag objects** - Annotated tags
- ✅ **Blob objects** - File contents

## Examples

### Example 1: Create SHA-256 Repository

```typescript
import { init, add, commit } from 'universal-git'

// Initialize with SHA-256
await init({
  fs,
  dir: '/path/to/repo',
  objectFormat: 'sha256'
})

// Add and commit (uses SHA-256 automatically)
await add({ fs, dir: '/path/to/repo', filepath: 'file.txt' })
const oid = await commit({
  fs,
  dir: '/path/to/repo',
  message: 'Initial commit'
})

console.log(oid) // 64-character SHA-256 hash
```

### Example 2: Check Object Format

```typescript
import { detectObjectFormat } from 'universal-git/utils/detectObjectFormat'

// Check format before operations
const format = await detectObjectFormat(fs, gitdir)

if (format === 'sha256') {
  console.log('Repository uses SHA-256')
  // OIDs will be 64 characters
} else {
  console.log('Repository uses SHA-1')
  // OIDs will be 40 characters
}
```

### Example 3: Hash with Specific Format

```typescript
import { hashBlob } from 'universal-git'

// Hash with SHA-1 (default)
const sha1Result = await hashBlob({
  object: 'Hello, world!',
  objectFormat: 'sha1'
})

// Hash with SHA-256
const sha256Result = await hashBlob({
  object: 'Hello, world!',
  objectFormat: 'sha256'
})

console.log('SHA-1:', sha1Result.oid)   // 40 characters
console.log('SHA-256:', sha256Result.oid) // 64 characters
```

## Configuration

### Repository Configuration

SHA-256 repositories have this configuration:

```ini
[extensions]
    objectformat = sha256
```

This is set automatically when you initialize with `objectFormat: 'sha256'`.

### Format Detection

The object format is automatically detected from:
1. `.git/config` file (`extensions.objectformat` setting)
2. Defaults to SHA-1 if not specified

## OID Length

- **SHA-1**: 40 hexadecimal characters
- **SHA-256**: 64 hexadecimal characters

```typescript
// SHA-1 OID
const sha1Oid = 'abc123def4567890123456789012345678901234' // 40 chars

// SHA-256 OID
const sha256Oid = 'abc123def4567890123456789012345678901234567890123456789012345678901234' // 64 chars
```

## Compatibility

### Repository Compatibility

- **SHA-1 repositories**: Can be used with universal-git (default)
- **SHA-256 repositories**: Fully supported, all operations work
- **Mixed repositories**: Not supported (one format per repository)

### Native Git Compatibility

- **SHA-1**: Fully compatible with native Git
- **SHA-256**: Compatible with Git 2.42+ (requires `extensions.objectformat`)

### Migration

You cannot convert an existing SHA-1 repository to SHA-256. You must:
1. Create a new repository with SHA-256
2. Re-import your data

## Best Practices

### 1. Choose Format at Initialization

```typescript
// ✅ Good: Choose format when creating repository
await init({
  fs,
  dir: '/path/to/repo',
  objectFormat: 'sha256'  // Choose at creation
})

// ❌ Not possible: Cannot change format later
```

### 2. Detect Format Before Operations

```typescript
// Check format before using OIDs
const format = await detectObjectFormat(fs, gitdir)

if (format === 'sha256') {
  // Expect 64-character OIDs
} else {
  // Expect 40-character OIDs
}
```

### 3. Use Consistent Format

```typescript
// ✅ Good: Use same format throughout
await init({ fs, dir, objectFormat: 'sha256' })
// All operations use SHA-256

// ❌ Bad: Don't mix formats
// (Not possible - one format per repository)
```

## Limitations

1. **No Conversion**: Cannot convert SHA-1 to SHA-256 repositories
2. **One Format Per Repository**: Each repository uses one format
3. **Native Git**: Requires Git 2.42+ for SHA-256 support
4. **Network Protocol**: Some Git servers may not support SHA-256

## Troubleshooting

### Wrong OID Length

If you get OIDs with unexpected length:

```typescript
// Check the repository format
const format = await detectObjectFormat(fs, gitdir)
console.log('Format:', format)
console.log('Expected OID length:', format === 'sha256' ? 64 : 40)
```

### Format Not Detected

If format detection fails:

1. Check `.git/config`:
   ```typescript
   const config = await readConfig({ fs, gitdir })
   const format = config.get('extensions.objectformat')
   console.log('Format from config:', format)
   ```

2. Verify repository was initialized with SHA-256:
   ```typescript
   // Check if extensions.objectformat is set
   ```

## See Also

- [Init](./init.md) - Initialize repositories
- [Hash Blob](./hash-blob.md) - Hash objects
- [Architecture](./architecture.md) - Code structure

